<!-- HEADER (uguale allâ€™allegato, con selettore Auto / Laptop / Smartphone) -->
<header>
  <div class="title">
    <img src="./icons/icon-192.png" alt="logo">
    <h1>Cashflow Rush â€” Dual Universe v3.0.0 + Mobile Layout</h1>
  </div>
  <div class="actions">
    <div class="seg" id="modeSeg">
      <button data-mode="auto" class="active">Auto</button>
      <button data-mode="desktop">ðŸ’» Laptop</button>
      <button data-mode="mobile">ðŸ“± Smartphone</button>
    </div>
    <button class="btn" id="resetBtn">Reset</button>
    <button class="btn" id="undoBtn">Undo</button>
    <button class="btn" id="muteBtn">ðŸ”Š</button>
    <button class="btn" id="levelsBtn">ðŸ“ˆ Livelli</button>
  </div>
</header>

<!-- DESKTOP -->
<section class="desk">
  <div class="stageDesk">
    <!-- Canvas DESKTOP (id fisso: gameDesk) -->
    <canvas id="gameDesk" width="720" height="720"></canvas>
    <div class="playOverlay" id="playOverlayDesk"><button class="playBtn" id="playBtnDesk">PLAY</button></div>
  </div>
  <aside class="panel">â€¦ KPI + legenda â€¦</aside>
</section>

<!-- MOBILE KPI -->
<section class="mobileKPI">
  <div class="grid">
    <div class="kpi"><b>Valore Netto</b><span id="mNet2">0â‚¬</span></div>
    <div class="kpi"><b>Flusso â‚¬/mossa</b><span id="mFlow2">0â‚¬/mossa</span></div>
    <div class="kpi"><b>Mosse</b><span id="mMoves2">0</span></div>
    <div class="kpi"><b>Obiettivo</b><span id="mTarget2">50.000â‚¬</span></div>
  </div>
</section>

<!-- MOBILE STAGE -->
<section class="stageMob">
  <div class="frameMob">
    <!-- Canvas MOBILE (id fisso: gameMob) -->
    <canvas id="gameMob" width="720" height="720"></canvas>
    <div class="playOverlay" id="playOverlayMob"><button class="playBtn" id="playBtnMob">PLAY</button></div>
  </div>

  <!-- 3 colonne: legenda SX | D-PAD | legenda DX (come lâ€™allegato) -->
  <div class="controlsRow">
    <div class="legendCol left">
      <span class="tag"><span class="dot" style="background:#ffd700"></span>Monete</span>
      <span class="tag"><span class="dot" style="background:#8a56ff"></span>Leva</span>
      <span class="tag"><span class="dot" style="background:#2dd36f"></span>Asset</span>
    </div>

    <div class="touchpad" aria-label="Pad direzionale">
      <button data-dx="0" data-dy="-1" aria-label="Su">â–²</button>
      <div class="row">
        <button data-dx="-1" data-dy="0" aria-label="Sinistra">â—€</button>
        <button data-dx="1" data-dy="0" aria-label="Destra">â–¶</button>
      </div>
      <button data-dx="0" data-dy="1" aria-label="Giu">â–¼</button>
    </div>

    <div class="legendCol">
      <span class="tag"><span class="dot" style="background:#3dc2ff"></span>Dividendo</span>
      <span class="tag"><span class="dot" style="background:#ffaa00"></span>Inflazione</span>
      <span class="tag"><span class="dot" style="background:#ff4d4d"></span>Tassa</span>
    </div>
  </div>
</section>

<footer>Â© 2025 pezzaliAPP â€” MIT â€¢ Funziona offline come PWA</footer>

<!-- **IMPORTANTE**: carica prima il wrapper dual, poi il tuo app v3.0.0 (che funzionava) -->
<script src="./dual.js?v=3.1.6"></script>
<script src="./app.js?v=3.0.0"></script>

<!-- SW con cache-busting -->
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js?v=3.1.6').then(reg=>{
    if(reg.waiting){ reg.waiting.postMessage({type:'SKIP_WAITING'}); }
    reg.addEventListener('updatefound', ()=>{
      const nw = reg.installing;
      nw && nw.addEventListener('statechange', ()=>{ if(nw.state==='installed'){ location.reload(); } });
    });
  });
  navigator.serviceWorker.addEventListener('controllerchange', ()=>location.reload());
  navigator.serviceWorker.addEventListener('message', (ev) => { if (ev.data && ev.data.type === 'SW_UPDATED') location.reload(); });
}
</script>
